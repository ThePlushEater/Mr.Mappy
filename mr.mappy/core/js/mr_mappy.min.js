function prepareUpload(n){files=n.target.files}function uploadFiles(n,t){n.stopPropagation();n.preventDefault();var i=new FormData;$.each(files,function(n,t){i.append(n,t)});$.ajax({url:FMS.getBaseUrl()+"core/php/upload.php?files",type:"POST",data:i,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(i){typeof i.error=="undefined"?submitForm(n,i,t):console.log("ERRORS: "+i.error)},error:function(n,t){console.log("ERRORS: "+t)}})}function submitForm(n,t,i){$form=$(n.target);var r=$form.serialize();$.each(t.files,function(n,t){r=r+"&filenames[]="+t});$.ajax({url:FMS.getBaseUrl()+"core/php/upload.php",type:"POST",data:r,cache:!1,dataType:"json",success:function(n){typeof n.error=="undefined"?i.save({url:n.formData.filenames[0].replace("../../content/picture/","")},{success:function(n){FMM.getPictures().add(n);FMV.getUIView().render();n.setIsSavable(!0);FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewUIDataDeleteSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewUIDataSaveErrorMsg())}}):console.log("ERRORS: "+n.error)},error:function(n,t){console.log("ERRORS: "+t)},complete:function(){}})}var FMC,FMS,FML,FMV,FMM,files,FMViewTemplate,FMUIInfoLayerTemplate,FMUIAddLayerTemplate,FMViewUIDataLayerTemplate,FMViewUIThresholdLayerTemplate,FMViewUIDataLayerDeleteTemplate,FMViewUIDataLayerAddTemplate,FMViewUILayerPictureTemplate,FMViewUIPictureTemplate,FMUIPictureSelectTemplate,FMUIPictureAddTemplate,FMViewGalleryTemplate,FMViewLayerTemplate,FMViewUIDataTemplate,FMViewUIDataTemplateDonor,UIMode,FMMsgViewErrorTemplate,FMMsgViewSuccessTemplate,FMMapControlViewTemplate,ItemType,__extends,ForagingMap;$(document).ready(function(){var n=window.location;FMC=new ForagingMap.Controller;FMS=new ForagingMap.Setting(n.origin+window.location.pathname);FML=new ForagingMap.Localization;FMS.fetch(FMC.initialize)}),function(n){var t=function(){function t(){this.router=new n.Router}return t.prototype.initialize=function(){FMV=new n.View({el:$("#fm-view-main")});FMM=new n.Model;FMC.fetchLayers();FMC.addKeyEventListener()},t.prototype.getRouter=function(){return this.router},t.prototype.setSelectedItem=function(n){this.selectedItem=n},t.prototype.getSelectedItem=function(){return this.selectedItem},t.prototype.hasSelectedItem=function(){return this.selectedItem!=null?!0:!1},t.prototype.addKeyEventListener=function(){$(document).keyup(function(n){n.keyCode==27&&FMV.getUIView().getMode()!=1&&(FMV.getUIView().hide(),FMV.getMapView().resize(!1),FMV.getMapView().getMarkersView().inactiveMarkers(),FMV.getMapView().getControlView().resetControls())})},t.prototype.fetchLayers=function(){FMM.getLayers().fetch({remove:!1,processData:!0,success:function(){FMV.render();Backbone.history.start()},error:function(){}})},t.prototype.fetchItems=function(n){var t=this;FMM.getItems().fetch({remove:!1,processData:!0,data:{south:n.getSouthEast().lat,north:n.getNorthEast().lat,west:n.getSouthWest().lng,east:n.getSouthEast().lng},success:function(){FMV.getMapView().getMarkersView().render();t.fetchGives(FMM.getItems().getIdsToString())},error:function(){}})},t.prototype.createItem=function(){var t=new n.Item({name:"New Item",desc:"",type:0,sort:0,amount:0,lat:FMV.getMapView().getMap().getCenter().lat,lng:FMV.getMapView().getMap().getCenter().lng,date:moment(new Date).format(FMS.getDateTimeFormat()),update:moment(new Date).format(FMS.getDateTimeFormat())});return FMM.getItems().add(t),t},t.prototype.removeItem=function(n){return FMM.getItems().remove(n),n},t.prototype.fetchPictures=function(n){FMM.getPictures().fetch({remove:!0,processData:!0,data:{pid:n},success:function(){},error:function(){}})},t.prototype.fetchGives=function(n){var t=this;FMM.getGives().fetch({remove:!1,processData:!0,data:{pids:n},success:function(){FMV.getMapView().getMarkersView().renderPaths();FMV.getMapView().getMarkersView().getIsSelectable()||FMV.getMapView().getMarkersView().setIsSelectable(!0)},error:function(){}})},t}();n.Controller=t}(ForagingMap||(ForagingMap={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var t=function(n){function t(t){this.routes={"":"home","map/:zoom/:lat/:lon":"map"};n.call(this,t)}return __extends(t,n),t.prototype.initialize=function(){},t.prototype.home=function(){this.navigate("map/"+FMS.getDefaultZoom()+"/"+FMS.getDefaultLat()+"/"+FMS.getDefaultLng(),{trigger:!0,replace:!0})},t.prototype.map=function(n,t,i){FMV.getMapView().renderMap(t,i,n)},t}(Backbone.Router);n.Router=t}(ForagingMap||(ForagingMap={})),function(n){var t=function(){function t(){this.url="core/json/localization.json?"+moment();this.error="N/A"}return t.prototype.fetch=function(t){var i=this;$.getJSON(n.Setting.BASE_URL+this.url,{cache:!1}).done(function(n){i.data=n.en;t()})},t.prototype.getViewTitle=function(){return this.data.view.title?this.data.view.title:this.error},t.prototype.getViewCreator=function(){return this.data.view.creator?this.data.view.creator:this.error},t.prototype.getViewList=function(){return this.data.view.list?this.data.view.list:this.error},t.prototype.getViewMap=function(){return this.data.view.map?this.data.view.map:this.error},t.prototype.getViewLogIn=function(){return this.data.view.login?this.data.view.login:this.error},t.prototype.getViewSignUp=function(){return this.data.view.signup?this.data.view.signup:this.error},t.prototype.getViewMenu=function(){return this.data.view.menu?this.data.view.menu:this.error},t.prototype.getViewUIItemNotSelectedErrorMsg=function(){try{return this.data.view.ui.itemNotSelectedErrorMsg}catch(n){return this.error}},t.prototype.getViewUILocateSuccessMsg=function(){try{return this.data.view.ui.locate.successMsg}catch(n){return this.error}},t.prototype.getViewUILocateErrorMsg=function(){try{return this.data.view.ui.locate.errorMsg}catch(n){return this.error}},t.prototype.getViewUIInfoHeader=function(){try{return this.data.view.ui.info.header}catch(n){return this.error}},t.prototype.getViewUIInfoSaveSuccessMsg=function(){try{return this.data.view.ui.info.saveSuccessMsg}catch(n){return this.error}},t.prototype.getViewUIInfoSaveErrorMsg=function(){try{return this.data.view.ui.info.saveErrorMsg}catch(n){return this.error}},t.prototype.getViewUIInfoDeleteConfirmMsg=function(){try{return this.data.view.ui.info.deleteConfirmMsg}catch(n){return this.error}},t.prototype.getViewUIInfoDeleteSuccessMsg=function(){try{return this.data.view.ui.info.deleteSuccessMsg}catch(n){return this.error}},t.prototype.getViewUIInfoDeleteErrorMsg=function(){try{return this.data.view.ui.info.deleteErrorMsg}catch(n){return this.error}},t.prototype.getViewUIAddHeader=function(){try{return this.data.view.ui.add.header}catch(n){return this.error}},t.prototype.getViewUIAddTypeSelectError=function(){try{return this.data.view.ui.add.typeSelectError}catch(n){return this.error}},t.prototype.getViewUIDataHeader=function(){try{return this.data.view.ui.data.header}catch(n){return this.error}},t.prototype.getViewUIDataSaveSuccessMsg=function(){try{return this.data.view.ui.data.saveSuccessMsg}catch(n){return this.error}},t.prototype.getViewUIDataSaveErrorMsg=function(){try{return this.data.view.ui.data.saveErrorMsg}catch(n){return this.error}},t.prototype.getViewUIDataDonorNoAccessMsg=function(){try{return this.data.view.ui.data.donorNoAccessMsg}catch(n){return this.error}},t.prototype.getViewUIDataDeleteConfirmMsg=function(){try{return this.data.view.ui.data.deleteConfirmMsg}catch(n){return this.error}},t.prototype.getViewUIDataDeleteSuccessMsg=function(){try{return this.data.view.ui.data.deleteSuccessMsg}catch(n){return this.error}},t.prototype.getViewUIDataDeleteErrorMsg=function(){try{return this.data.view.ui.data.deleteErrorMsg}catch(n){return this.error}},t.prototype.getViewUIDataNoDataMsg=function(){try{return this.data.view.ui.data.noDataMsg}catch(n){return this.error}},t.prototype.getViewUIPictureHeader=function(){try{return this.data.view.ui.picture.header}catch(n){return this.error}},t.prototype.getViewUIThresholdHeader=function(){try{return this.data.view.ui.threshold.header}catch(n){return this.error}},t.prototype.getViewMarkerSaveSuccessMsg=function(){try{return this.data.view.map.marker.saveSuccessMsg}catch(n){return this.error}},t.prototype.getViewMarkerSaveErrorMsg=function(){try{return this.data.view.map.marker.saveErrorMsg}catch(n){return this.error}},t.prototype.getViewUILayerHeader=function(){try{return this.data.view.ui.layer.header}catch(n){return this.error}},t}();n.Localization=t}(ForagingMap||(ForagingMap={})),function(n){var t=function(){function n(t){this.url="core/json/setting.json";n.BASE_URL=t}return n.prototype.fetch=function(t){var i=this;$.getJSON(n.BASE_URL+this.url,{}).done(function(n){i.data=n.setting;FML.fetch(t)})},n.prototype.getMaxZoom=function(){return parseInt(this.data.maxZoom)},n.prototype.getDefaultZoom=function(){return parseInt(this.data.defaultZoom)},n.prototype.getDefaultLat=function(){return parseFloat(this.data.defaultLat)},n.prototype.getDefaultLng=function(){return parseFloat(this.data.defaultLng)},n.prototype.getTileMapAddress=function(){return this.data.tileMapAddress},n.prototype.getMsgTimeout=function(){return parseInt(this.data.msgTimeout)},n.prototype.getDateTimeFormat=function(){return this.data.dateTimeFormat},n.prototype.getImageDir=function(){return this.data.imageDir},n.prototype.getImageMarkerBlank=function(){return this.data.imageMarkerBlank},n.prototype.getImageMarkerHeart=function(){return this.data.imageMarkerHeart},n.prototype.getImageMarkerDollar=function(){return this.data.imageMarkerDollar},n.prototype.getImageMarkerNew=function(){return this.data.imageMarkerNew},n.prototype.getImageMarkerShadow=function(){return this.data.imageMarkerShadow},n.prototype.getCircleRadiusMultiplier=function(){return this.data.circleRadiusMultiplier},n.prototype.getTempCircleColor=function(){return this.data.tempCircleColor},n.prototype.getFruitCircleColor=function(){return this.data.fruitCircleColor},n.prototype.getStationCircleColor=function(){return this.data.stationCircleColor},n.prototype.getZeroAlpha=function(){return this.data.zeroAlpha},n.prototype.getInactiveAlpha=function(){return this.data.inactiveAlpha},n.prototype.getHalfAlpha=function(){return this.data.halfAplha},n.prototype.getActiveAlpha=function(){return this.data.activeAlpha},n.prototype.getFullAlpha=function(){return this.data.fullAlpha},n.prototype.getLocateZoom=function(){return this.data.locateZoom},n.prototype.getPictureDir=function(){return this.data.pictureDir},n.prototype.getBaseUrl=function(){return n.BASE_URL},n.prototype.getMapRefreshRate=function(){return this.data.mapRefreshRate},n.prototype.getEventCircleColor=function(){return this.data.eventCircleColor},n.prototype.getOrganizationCircleColor=function(){return this.data.organizationCircleColor},n.prototype.getDonorCircleColor=function(){return this.data.donorCircleColor},n}();n.Setting=t}(ForagingMap||(ForagingMap={}));FMViewTemplate="";FMViewTemplate+='<div id="fm-view-body" class="panel panel-primary">';FMViewTemplate+='<div class="panel-heading">';FMViewTemplate+='<div class="panel-title nav-title"><%= title %><\/div>';FMViewTemplate+='<div class="btn-group nav-primary" role="group" aria-label="nav-primary">';FMViewTemplate+='<div id="fm-view-slider"><\/div>';FMViewTemplate+="<\/div>";FMViewTemplate+='<div class="btn-group nav-secondary" role="group" aria-label="nav-secondary">';FMViewTemplate+='<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-tasks"><\/span> <%= menu %><\/button>';FMViewTemplate+="<\/div>";FMViewTemplate+='<div class="clear" />';FMViewTemplate+="<\/div>";FMViewTemplate+='<div id="fm-view-map">';FMViewTemplate+='<div id="leaflet-view-ui"><\/div>';FMViewTemplate+='<div id="leaflet-view-map"><\/div>';FMViewTemplate+='<div id="leaflet-view-msg"><\/div>';FMViewTemplate+='<div id="leaflet-view-galleria">';FMViewTemplate+="<\/div>";FMViewTemplate+="<\/div>";FMViewTemplate+="<\/div>";FMUIInfoLayerTemplate="";FMUIInfoLayerTemplate+='<div class="ui-header"><%= header %><\/div>';FMUIInfoLayerTemplate+='<div class="ui-body">';FMUIInfoLayerTemplate+='<form class="form-horizontal">';FMUIInfoLayerTemplate+='<div class="form-group">';FMUIInfoLayerTemplate+='<label for="item-info-id" class="col-xs-3 control-label">#id<\/label>';FMUIInfoLayerTemplate+='<div class="col-xs-9">';FMUIInfoLayerTemplate+='<input type="text" class="form-control" placeholder="" id="item-info-id" value="<%= id %>" readonly>';FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+='<div class="form-group">';FMUIInfoLayerTemplate+='<label for="item-info-name" class="col-xs-3 control-label">Name<\/label>';FMUIInfoLayerTemplate+='<div class="col-xs-9">';FMUIInfoLayerTemplate+='<input type="text" class="form-control" placeholder="" id="item-info-name" value="<%= name %>">';FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+='<div class="form-group">';FMUIInfoLayerTemplate+='<label for="item-info-desc" class="col-xs-3 control-label">Description<\/label>';FMUIInfoLayerTemplate+='<div class="col-xs-9">';FMUIInfoLayerTemplate+='<input type="text" class="form-control" placeholder="" id="item-info-desc" value="<%= desc %>">';FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+='<div class="form-group">';FMUIInfoLayerTemplate+='<label for="item-info-type" class="col-xs-3 control-label">Type<\/label>';FMUIInfoLayerTemplate+='<div class="col-xs-9">';FMUIInfoLayerTemplate+='<select id="item-info-type" class="selectpicker">';FMUIInfoLayerTemplate+='<optgroup label="Event">';FMUIInfoLayerTemplate+="<% _.each(sort1, function (sort) { %>";FMUIInfoLayerTemplate+='<option data-type="1" data-sort="<%= sort.get("id") %>"><%= sort.get("name") %><\/option>';FMUIInfoLayerTemplate+="<% }); %>";FMUIInfoLayerTemplate+="<\/optgroup>";FMUIInfoLayerTemplate+='<optgroup label="Organization">';FMUIInfoLayerTemplate+="<% _.each(sort2, function (sort) { %>";FMUIInfoLayerTemplate+='<option data-type="2" data-sort="<%= sort.get("id") %>"><%= sort.get("name") %><\/option>';FMUIInfoLayerTemplate+="<% }); %>";FMUIInfoLayerTemplate+="<\/optgroup>";FMUIInfoLayerTemplate+='<optgroup label="Donor">';FMUIInfoLayerTemplate+="<% _.each(sort3, function (sort) { %>";FMUIInfoLayerTemplate+='<option data-type="3" data-sort="<%= sort.get("id") %>"><%= sort.get("name") %><\/option>';FMUIInfoLayerTemplate+="<% }); %>";FMUIInfoLayerTemplate+="<\/optgroup>";FMUIInfoLayerTemplate+="<\/select>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+='<div class="form-group">';FMUIInfoLayerTemplate+='<label for="item-info-amount" class="col-xs-3 control-label">Money<\/label>';FMUIInfoLayerTemplate+='<div class="col-xs-9">';FMUIInfoLayerTemplate+='<div class="input-group">';FMUIInfoLayerTemplate+='<input type="text" class="form-control" placeholder="" id="item-info-amount" value="<%= amount %>" readonly />';FMUIInfoLayerTemplate+='<span class="input-group-addon">$<\/span>';FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+='<div class="form-group">';FMUIInfoLayerTemplate+='<label for="item-info-lat" class="col-xs-3 control-label">Latitude<\/label>';FMUIInfoLayerTemplate+='<div class="col-xs-9">';FMUIInfoLayerTemplate+='<div class="input-group">';FMUIInfoLayerTemplate+='<input type="text" class="form-control" placeholder="" id="item-info-lat" value="<%= lat %>">';FMUIInfoLayerTemplate+='<span class="input-group-addon">°<\/span>';FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+='<div class="form-group">';FMUIInfoLayerTemplate+='<label for="item-info-lng" class="col-xs-3 control-label">Longitude<\/label>';FMUIInfoLayerTemplate+='<div class="col-xs-9">';FMUIInfoLayerTemplate+='<div class="input-group">';FMUIInfoLayerTemplate+='<input type="text" class="form-control" placeholder="" id="item-info-lng" value="<%= lng %>">';FMUIInfoLayerTemplate+='<span class="input-group-addon">°<\/span>';FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+='<div class="form-group">';FMUIInfoLayerTemplate+='<label for="item-info-date" class="col-xs-3 control-label">Date<\/label>';FMUIInfoLayerTemplate+='<div class="col-xs-9">';FMUIInfoLayerTemplate+='<div class="input-group date" id="item-info-date-picker">';FMUIInfoLayerTemplate+='<input type="text" class="form-control" id="item-info-date" value="<%= date %>" />';FMUIInfoLayerTemplate+='<span class="input-group-addon input-group-addon-click" id="item-info-date-select"><\/span>';FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+='<div class="form-group">';FMUIInfoLayerTemplate+='<label for="item-info-reg" class="col-xs-3 control-label">Updated<\/label>';FMUIInfoLayerTemplate+='<div class="col-xs-9">';FMUIInfoLayerTemplate+='<input type="text" class="form-control" placeholder="" id="item-info-reg" value="<%= update %>" readonly>';FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+="<\/div>";FMUIInfoLayerTemplate+='<button id="item-info-btn-edit" type="button" class="btn btn-default col-xs-6"><span class="glyphicon glyphicon-ok"><\/span> Save<\/button>';FMUIInfoLayerTemplate+='<button id="item-info-btn-delete" type="button" class="btn btn-default col-xs-6"><span class="glyphicon glyphicon-remove"><\/span> Delete<\/button>';FMUIInfoLayerTemplate+='<div style="clear:both;"/>';FMUIInfoLayerTemplate+="<\/form>";FMUIInfoLayerTemplate+="<\/div>";FMUIAddLayerTemplate="";FMUIAddLayerTemplate+='<div class="ui-header"><%= header %><\/div>';FMUIAddLayerTemplate+='<div class="ui-body">';FMUIAddLayerTemplate+='<form class="form-horizontal">';FMUIAddLayerTemplate+='<div class="form-group">';FMUIAddLayerTemplate+='<label for="item-info-name" class="col-xs-3 control-label">Name<\/label>';FMUIAddLayerTemplate+='<div class="col-xs-9">';FMUIAddLayerTemplate+='<input type="text" class="form-control" placeholder="" id="item-info-name" value="<%= name %>">';FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+='<div class="form-group">';FMUIAddLayerTemplate+='<label for="item-info-desc" class="col-xs-3 control-label">Description<\/label>';FMUIAddLayerTemplate+='<div class="col-xs-9">';FMUIAddLayerTemplate+='<input type="text" class="form-control" placeholder="" id="item-info-desc" value="<%= desc %>">';FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+='<div class="form-group">';FMUIAddLayerTemplate+='<label for="item-info-type" class="col-xs-3 control-label">Type<\/label>';FMUIAddLayerTemplate+='<div class="col-xs-9">';FMUIAddLayerTemplate+='<select id="item-info-type" class="selectpicker">';FMUIAddLayerTemplate+='<optgroup label="None">';FMUIAddLayerTemplate+='<option data-type="0" data-sort="0">None<\/option>';FMUIAddLayerTemplate+="<\/optgroup>";FMUIAddLayerTemplate+='<optgroup label="Event">';FMUIAddLayerTemplate+="<% _.each(sort1, function (sort) { %>";FMUIAddLayerTemplate+='<option data-type="1" data-sort="<%= sort.get("id") %>"><%= sort.get("name") %><\/option>';FMUIAddLayerTemplate+="<% }); %>";FMUIAddLayerTemplate+="<\/optgroup>";FMUIAddLayerTemplate+='<optgroup label="Organization">';FMUIAddLayerTemplate+="<% _.each(sort2, function (sort) { %>";FMUIAddLayerTemplate+='<option data-type="2" data-sort="<%= sort.get("id") %>"><%= sort.get("name") %><\/option>';FMUIAddLayerTemplate+="<% }); %>";FMUIAddLayerTemplate+="<\/optgroup>";FMUIAddLayerTemplate+='<optgroup label="Donor">';FMUIAddLayerTemplate+="<% _.each(sort3, function (sort) { %>";FMUIAddLayerTemplate+='<option data-type="3" data-sort="<%= sort.get("id") %>"><%= sort.get("name") %><\/option>';FMUIAddLayerTemplate+="<% }); %>";FMUIAddLayerTemplate+="<\/optgroup>";FMUIAddLayerTemplate+="<\/select>";FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+='<div class="form-group">';FMUIAddLayerTemplate+='<label for="item-info-date" class="col-xs-3 control-label">Date<\/label>';FMUIAddLayerTemplate+='<div class="col-xs-9">';FMUIAddLayerTemplate+='<div class="input-group date" id="item-info-date-picker">';FMUIAddLayerTemplate+='<input type="text" class="form-control" id="item-info-date" value="<%= date %>">';FMUIAddLayerTemplate+='<span class="input-group-addon input-group-addon-click" id="item-info-date-select"><\/span>';FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+='<div class="form-group">';FMUIAddLayerTemplate+='<label for="item-info-lat" class="col-xs-3 control-label">Latitude<\/label>';FMUIAddLayerTemplate+='<div class="col-xs-9">';FMUIAddLayerTemplate+='<div class="input-group">';FMUIAddLayerTemplate+='<input type="text" class="form-control" placeholder="" id="item-info-lat" value="<%= lat %>">';FMUIAddLayerTemplate+='<span class="input-group-addon">°<\/span>';FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+='<div class="form-group">';FMUIAddLayerTemplate+='<label for="item-info-lng" class="col-xs-3 control-label">Longitude<\/label>';FMUIAddLayerTemplate+='<div class="col-xs-9">';FMUIAddLayerTemplate+='<div class="input-group">';FMUIAddLayerTemplate+='<input type="text" class="form-control" placeholder="" id="item-info-lng" value="<%= lng %>">';FMUIAddLayerTemplate+='<span class="input-group-addon">°<\/span>';FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+="<\/div>";FMUIAddLayerTemplate+='<button id="item-info-btn-edit" type="button" class="btn btn-default col-xs-6"><span class="glyphicon glyphicon-ok"><\/span> Save<\/button>';FMUIAddLayerTemplate+='<button id="item-info-btn-delete" type="button" class="btn btn-default col-xs-6"><span class="glyphicon glyphicon-remove"><\/span> Cancel<\/button>';FMUIAddLayerTemplate+='<div style="clear:both;"/>';FMUIAddLayerTemplate+="<\/form>";FMUIAddLayerTemplate+="<\/div>";FMViewUIDataLayerTemplate="";FMViewUIDataLayerTemplate+='<div class="ui-header"><%= header %><\/div>';FMViewUIDataLayerTemplate+='<div class="ui-body">';FMViewUIDataLayerTemplate+='<button type="button" data-toggle="collapse" data-target="#date-add-panel" class="btn btn-default col-xs-12"><span class="glyphicon glyphicon-plus"><\/span> Add New Data<\/button>';FMViewUIDataLayerTemplate+='<div class="collapse" id="date-add-panel">';FMViewUIDataLayerTemplate+="<\/div>";FMViewUIDataLayerTemplate+="<\/div>";FMViewUIThresholdLayerTemplate="";FMViewUIThresholdLayerTemplate+='<div class="ui-header"><%= header %><\/div>';FMViewUIThresholdLayerTemplate+='<div class="ui-body">';FMViewUIThresholdLayerTemplate+='<button type="button" data-toggle="collapse" data-target="#threshold-add-panel" class="btn btn-default col-xs-12"><span class="glyphicon glyphicon-plus"><\/span> Add New Threshold<\/button>';FMViewUIThresholdLayerTemplate+='<div class="collapse" id="threshold-add-panel">';FMViewUIThresholdLayerTemplate+="<\/div>";FMViewUIThresholdLayerTemplate+="<\/div>";FMViewUIDataLayerDeleteTemplate="";FMViewUIDataLayerDeleteTemplate='<button type="button" class="btn btn-default btn-table"><span class="glyphicon glyphicon-remove"><\/span><\/button>';FMViewUIDataLayerAddTemplate="";FMViewUIDataLayerAddTemplate='<button type="button" class="btn btn-default btn-table"><span class="glyphicon glyphicon-plus"><\/span><\/button>';FMViewUILayerPictureTemplate="";FMViewUILayerPictureTemplate+='<div class="ui-header"><%= header %><\/div>';FMViewUILayerPictureTemplate+='<div class="ui-body ui-picture">';FMViewUILayerPictureTemplate+='<button type="button" data-toggle="collapse" data-target="#picture-add-panel" class="btn btn-default col-xs-12"><span class="glyphicon glyphicon-plus"><\/span> Add New Picture<\/button>';FMViewUILayerPictureTemplate+='<div class="collapse" id="picture-add-panel">';FMViewUILayerPictureTemplate+="<\/div>";FMViewUILayerPictureTemplate+="<\/div>";FMViewUIPictureTemplate="";FMViewUIPictureTemplate+='<img class="picture-thumbnail" src="<%= url %>" />';FMUIPictureSelectTemplate="";FMUIPictureSelectTemplate+='<input class="fileupload" type="file" accept="image/*" capture="camera" />';FMUIPictureAddTemplate="";FMUIPictureAddTemplate='<button type="button" class="btn btn-default btn-table"><span class="glyphicon glyphicon-plus"><\/span><\/button>';FMViewGalleryTemplate="";FMViewGalleryTemplate+='<button id="btn-galleria-close" type="button" class="btn btn-default btn-table"><span class="glyphicon glyphicon-remove-circle"><\/span> Close<\/button>';FMViewGalleryTemplate+='<div class="galleria">';FMViewGalleryTemplate+="<% _.each(pictures, function(picture) { %>";FMViewGalleryTemplate+='<img data-id="<%= picture.get("id") %>" src="<%= dir %><%= picture.get ("url") %>" data-title="<%= picture.get ("name") %>" data-description="<%= moment(picture.get("date")).format(FMS.getDateTimeFormat()) %>" />';FMViewGalleryTemplate+="<% }); %>";FMViewGalleryTemplate+="<\/div>";FMViewLayerTemplate="";FMViewLayerTemplate+='<div class="ui-header"><%= header %><\/div>';FMViewLayerTemplate+='<div class="ui-body">';FMViewLayerTemplate+='<button type="button" data-toggle="collapse" data-target="#layer-add-panel" class="btn btn-default col-xs-12"><span class="glyphicon glyphicon-plus"><\/span> Manage Layers<\/button>';FMViewLayerTemplate+='<div class="collapse <%= isIn %>" id="layer-add-panel">';FMViewLayerTemplate+='<div id="layer-add-grid"><\/div>';FMViewLayerTemplate+='<div id="layer-list-grid"><\/div>';FMViewLayerTemplate+="<\/div>";FMViewLayerTemplate+='<div class="checkbox btn btn-negative col-xs-12 layer-checkbox layer-checkbox-header">';FMViewLayerTemplate+='<label class="label-header"><input type="checkbox" id="check-unassigned-layer" data-sort="0" checked>Unassigned Layer Toggle<\/label>';FMViewLayerTemplate+="<\/div>";FMViewLayerTemplate+='<div class="checkbox btn btn-danger col-xs-12 layer-checkbox layer-checkbox-header">';FMViewLayerTemplate+='<label class="label-header"><input type="checkbox" id="check-event-layer" checked>Event Layer Toggle<\/label>';FMViewLayerTemplate+="<% _.each(sort1, function (sort) { %>";FMViewLayerTemplate+='<div class="checkbox btn btn-danger col-xs-12 layer-checkbox">';FMViewLayerTemplate+='<label><input type="checkbox" value= "" data-type="1" data-sort="<%= sort.get("id") %>"><%= sort.get("name") %> - <%= sort.get("desc") %><\/label>';FMViewLayerTemplate+="<\/div>";FMViewLayerTemplate+="<% }); %>";FMViewLayerTemplate+="<\/div>";FMViewLayerTemplate+='<div class="checkbox btn btn-success col-xs-12 layer-checkbox layer-checkbox-header">';FMViewLayerTemplate+='<label class="label-header"><input type="checkbox" id="check-organization-layer" checked>Organization Layer Toggle<\/label>';FMViewLayerTemplate+="<% _.each(sort2, function (sort) { %>";FMViewLayerTemplate+='<div class="checkbox btn btn-success col-xs-12 layer-checkbox">';FMViewLayerTemplate+='<label><input type="checkbox" value= "" data-type="2" data-sort="<%= sort.get("id") %>"><%= sort.get("name") %> - <%= sort.get("desc") %><\/label>';FMViewLayerTemplate+="<\/div>";FMViewLayerTemplate+="<% }); %>";FMViewLayerTemplate+="<\/div>";FMViewLayerTemplate+='<div class="checkbox btn btn-primary col-xs-12 layer-checkbox layer-checkbox-header">';FMViewLayerTemplate+='<label class="label-header"><input type="checkbox" id="check-donor-layer" checked>Donor Layer Toggle<\/label>';FMViewLayerTemplate+="<% _.each(sort3, function (sort) { %>";FMViewLayerTemplate+='<div class="checkbox btn btn-primary col-xs-12 layer-checkbox">';FMViewLayerTemplate+='<label><input type="checkbox" value= "" data-type="3" data-sort="<%= sort.get("id") %>"><%= sort.get("name") %> - <%= sort.get("desc") %><\/label>';FMViewLayerTemplate+="<\/div>";FMViewLayerTemplate+="<% }); %>";FMViewLayerTemplate+="<\/div>";FMViewUIDataTemplate="";FMViewUIDataTemplate+='<div class="ui-header"><%= header %><\/div>';FMViewUIDataTemplate+='<div class="ui-body">';FMViewUIDataTemplate+='<button type="button" data-toggle="collapse" data-target="#data-add-panel" class="btn btn-default col-xs-12"><span class="glyphicon glyphicon-plus"><\/span> Add New Data<\/button>';FMViewUIDataTemplate+='<div class="collapse" id="data-add-panel">';FMViewUIDataTemplate+="<\/div>";FMViewUIDataTemplate+="<\/div>";FMViewUIDataTemplateDonor="";FMViewUIDataTemplateDonor+='<div class="ui-header"><%= header %><\/div>';FMViewUIDataTemplateDonor+='<div class="ui-body">';FMViewUIDataTemplateDonor+="Donor cannot get donation from others.";FMViewUIDataTemplateDonor+="<\/div>";FMViewUIDataTemplateDonor+="<\/div>";__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var t=function(t){function i(n){t.call(this,n);this.setElement(n.el);this.origWidth=this.$el.innerWidth();this.origHeight=this.$el.innerHeight()}return __extends(i,t),i.prototype.render=function(){var t=_.template(FMViewTemplate),i={title:FML.getViewTitle(),list:FML.getViewList(),map:FML.getViewMap(),login:FML.getViewLogIn(),signup:FML.getViewSignUp(),menu:FML.getViewMenu()};this.$el.html(t(i));this.vMap=new n.MapView({el:$("#leaflet-view-map")});this.vUI=new n.UIView({el:$("#leaflet-view-ui")});this.vMsg=new n.MsgView({el:$("#leaflet-view-msg")});this.vGallery=new n.GalleryView({el:$("#leaflet-view-galleria")});this.resize()},i.prototype.resize=function(){this.origWidth=this.$el.innerWidth();this.origHeight=this.$el.innerHeight()},i.prototype.getOrigWidth=function(){return this.origWidth},i.prototype.getOrigHeight=function(){return this.origHeight},i.prototype.getMapView=function(){return this.vMap},i.prototype.getUIView=function(){return this.vUI},i.prototype.getMsgView=function(){return this.vMsg},i.prototype.getGalleryView=function(){return this.vGallery},i}(Backbone.View);n.View=t}(ForagingMap||(ForagingMap={}));var DatePickerCellEditor=Backgrid.InputCellEditor.extend({events:{},initialize:function(){Backgrid.InputCellEditor.prototype.initialize.apply(this,arguments);var n=this;$(this.el).datetimepicker({defaultDate:n.model.get("date"),format:FMS.getDateTimeFormat()}).on("dp.hide",function(){if($(this).data("date")!=undefined){var t=new Backgrid.Command({});n.model.set(n.column.get("name"),$(this).data("date"));n.model.trigger("backgrid:edited",n.model,n.column,t)}})}}),DeleteCell=Backgrid.Cell.extend({template:_.template(FMViewUIDataLayerDeleteTemplate),events:{click:"deleteRow"},deleteRow:function(n){var t=confirm(FML.getViewUIDataDeleteConfirmMsg());t==!0&&(n.preventDefault(),this.model.collection.remove(this.model),this.model.destroy({wait:!0,success:function(n){FMV.getUIView().render();n.get("value")!=undefined?FMV.getMsgView().renderSuccess("'"+n.get("value")+"' "+FML.getViewUIDataDeleteSuccessMsg()):n.get("name")!=undefined?FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewUIDataDeleteSuccessMsg()):n.get("min")!=undefined&&FMV.getMsgView().renderSuccess("'"+n.get("min")+" - "+n.get("max")+"' "+FML.getViewUIDataDeleteSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewUIDataDeleteErrorMsg())}}))},render:function(){return $(this.el).html(this.template()),this.delegateEvents(),this}}),AddCell=Backgrid.Cell.extend({template:_.template(FMViewUIDataLayerAddTemplate),events:{click:"addRow"},addRow:function(n){n.preventDefault();var t=this.model,i=this.model.collection;i.remove(t);FMM.getBends().add(t);t.save({},{success:function(n){FMV.getUIView().render();n.setIsSavable(!0);FMV.getMsgView().renderSuccess("'"+n.get("value")+"' "+FML.getViewUIDataDeleteSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewUIDataSaveErrorMsg())}})},render:function(){return $(this.el).html(this.template()),this.delegateEvents(),this}}),LayerAddCell=Backgrid.Cell.extend({template:_.template(FMViewUIDataLayerAddTemplate),events:{click:"addRow"},addRow:function(n){n.preventDefault();var t=this.model,i=this.model.collection;i.remove(t);FMM.getLayers().add(t);t.save({},{success:function(n){FMV.getUIView().render();n.setIsSavable(!0);FMV.getMsgView().renderSuccess("'"+n.get("value")+"' "+FML.getViewUIDataDeleteSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewUIDataSaveErrorMsg())}})},render:function(){return $(this.el).html(this.template()),this.delegateEvents(),this}}),DataAddCell=Backgrid.Cell.extend({template:_.template(FMViewUIDataLayerAddTemplate),events:{click:"addRow"},addRow:function(n){n.preventDefault();var t=this.model,i=this.model.collection;i.remove(t);FMM.getGives().add(t);t.save({},{success:function(n){FMV.getUIView().render();n.setIsSavable(!0);FMC.fetchItems(FMV.getMapView().getMapBounds());FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewUIDataDeleteSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewUIDataSaveErrorMsg())}})},render:function(){return $(this.el).html(this.template()),this.delegateEvents(),this}}),DataDeleteCell=Backgrid.Cell.extend({template:_.template(FMViewUIDataLayerDeleteTemplate),events:{click:"deleteRow"},deleteRow:function(n){var t=confirm(FML.getViewUIDataDeleteConfirmMsg());t==!0&&(n.preventDefault(),this.model.collection.remove(this.model),this.model.destroy({wait:!0,success:function(n){FMV.getUIView().render();FMV.getMapView().getMarkersView().renderPaths();n.get("value")!=undefined?FMV.getMsgView().renderSuccess("'"+n.get("value")+"' "+FML.getViewUIDataDeleteSuccessMsg()):n.get("name")!=undefined?FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewUIDataDeleteSuccessMsg()):n.get("min")!=undefined&&FMV.getMsgView().renderSuccess("'"+n.get("min")+" - "+n.get("max")+"' "+FML.getViewUIDataDeleteSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewUIDataDeleteErrorMsg())}}))},render:function(){return $(this.el).html(this.template()),this.delegateEvents(),this}}),PictureCell=Backgrid.Cell.extend({template:_.template(FMViewUIPictureTemplate),className:"picture-frame",events:{click:"zoomIn"},render:function(){var n={url:FMS.getBaseUrl()+FMS.getPictureDir()+this.model.get("url")};return $(this.el).html(this.template(n)),this.delegateEvents(),this},zoomIn:function(n){n.preventDefault();FMV.getGalleryView().render();FMV.getGalleryView().show($("table.backgrid img").index($(n.target)))}}),pictureColumn=[{name:"url",label:"Picture",editable:!1,cell:PictureCell},{name:"name",label:"Name",editable:!0,cell:"string"},{name:"date",label:"Date",editable:!0,cell:Backgrid.Cell.extend({editor:DatePickerCellEditor})},{label:"delete",sortable:!1,editable:!1,cell:DeleteCell}],PictureSelectCell=Backgrid.Cell.extend({template:_.template(FMUIPictureSelectTemplate),className:"picture-frame",events:{},render:function(){return $(this.el).html(this.template()),this.delegateEvents(),setTimeout(function(){$("#picture-add-panel input[type=file]").off("change");$("#picture-add-panel input[type=file]").on("change",prepareUpload)},500),this}}),PictureAddCell=Backgrid.Cell.extend({template:_.template(FMUIPictureAddTemplate),events:{click:"addRow"},addRow:function(n){console.log("try add");n.preventDefault();var t=this.model,i=this.model.collection;i.remove(t);uploadFiles(n,t)},render:function(){return $(this.el).html(this.template()),this.delegateEvents(),this}}),pictureAddColumn=[{name:"url",label:"Picture",editable:!1,cell:PictureSelectCell},{name:"name",label:"Name",editable:!0,cell:"string"},{name:"date",label:"Date",editable:!0,cell:Backgrid.Cell.extend({editor:DatePickerCellEditor})},{label:"add",sortable:!1,editable:!1,cell:PictureAddCell}],layerColumn=[{name:"type",label:"Type",editable:!0},{name:"name",label:"Name",editable:!0,cell:"string"},{name:"desc",label:"Desc",editable:!0,cell:"string"},{label:"delete",sortable:!1,editable:!1,cell:DeleteCell}],layerAddColumn=[{name:"type",label:"Type",editable:!0},{name:"name",label:"Name",editable:!0,cell:"string"},{name:"desc",label:"Desc",editable:!0,cell:"string"},{label:"add",sortable:!1,editable:!1,cell:LayerAddCell}],dataColumn=[{name:"gid",label:"Donor",editable:!0},{name:"name",label:"Name",editable:!0,cell:"string"},{name:"amount",label:"Amount ($)",editable:!0,cell:"number"},{name:"date",label:"Date",editable:!0,cell:Backgrid.Cell.extend({editor:DatePickerCellEditor})},{label:"delete",sortable:!1,editable:!1,cell:DataDeleteCell}],dataAddColumn=[{name:"gid",label:"Donor",editable:!0},{name:"name",label:"Name",editable:!0,cell:"string"},{name:"amount",label:"Amount ($)",editable:!0,cell:"number"},{name:"date",label:"Date",editable:!0,cell:Backgrid.Cell.extend({editor:DatePickerCellEditor})},{label:"add",sortable:!1,editable:!1,cell:DataAddCell}],__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},ForagingMap;(function(n){var t=function(t){function i(n){t.call(this,n);this.setElement(n.el)}return __extends(i,t),i.prototype.getMapZoom=function(){return this.lMap.getZoom()},i.prototype.getMapCenter=function(){return this.lMap.getCenter()},i.prototype.getMapBounds=function(){return this.lMap.getBounds()},i.prototype.renderMap=function(t,i,r){var u=this;if(u.lMap==null){u.lMap=L.map(u.$el[0].id,{closePopupOnClick:!1,zoomControl:!1,doubleClickZoom:!1}).setView(new L.LatLng(t,i),r);L.tileLayer(FMS.getTileMapAddress(),{maxZoom:FMS.getMaxZoom()}).addTo(u.lMap);u.lMap.invalidateSize(!1);u.lMap.on("moveend",function(){FMC.getRouter().navigate("map/"+u.getMapZoom()+"/"+u.getMapCenter().lat+"/"+u.getMapCenter().lng,{trigger:!1,replace:!0});u.waitForFetchData()});u.lMap.touchZoom.disable();u.lMap.doubleClickZoom.disable();u.lMap.whenReady(function(){FMC.fetchItems(u.lMap.getBounds());u.vMarkers=new n.MarkersView;u.vControl=new n.MapControlView({el:$(".leaflet-top.leaflet-right")})});u.lMap.on("dblclick",function(){FMV.getUIView().getMode()!=1&&(FMV.getUIView().hide(),FMV.getMapView().resize(!1),FMV.getMapView().getMarkersView().inactiveMarkers(),FMV.getMapView().getControlView().resetControls())})}else u.lMap.setView(new L.LatLng(t,i),r)},i.prototype.waitForFetchData=function(){var n=this;n.timeout!=null&&clearTimeout(n.timeout);n.timeout=setTimeout(function(){FMC.fetchItems(n.getMapBounds())},FMS.getMapRefreshRate())},i.prototype.getMap=function(){return this.lMap},i.prototype.getMarkersView=function(){return this.vMarkers},i.prototype.getControlView=function(){return this.vControl},i.prototype.resize=function(n){var t=this;FMV.getUIView().getIsOpen()?(t.$el.addClass("view-map-half"),t.$el.css({width:t.$el.parent().width()-FMV.getUIView().getOuterWidth()})):(t.$el.removeAttr("style"),t.$el.removeClass("view-map-half"));t.lMap.invalidateSize(!1);FMC.hasSelectedItem()&&n&&t.lMap.setView(new L.LatLng(parseFloat(FMC.getSelectedItem().get("lat")),parseFloat(FMC.getSelectedItem().get("lng"))))},i.prototype.SetIsMapPanZoomAvailable=function(n){n?(FMV.getMapView().getMap().dragging.enable(),FMV.getMapView().getMap().scrollWheelZoom.enable()):(FMV.getMapView().getMap().dragging.disable(),FMV.getMapView().getMap().scrollWheelZoom.disable())},i}(Backbone.View);n.MapView=t})(ForagingMap||(ForagingMap={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){n[n.NONE=0]="NONE";n[n.ADD=1]="ADD";n[n.INFO=2]="INFO";n[n.DATA=3]="DATA";n[n.PICTURE=4]="PICTURE";n[n.LAYER=5]="LAYER"}(UIMode||(UIMode={})),function(n){var t=function(t){function i(n){t.call(this,n);this.setElement(n.el);this.setIsLocked(!1);this.setMode(0);this.resize();this.hide();this.createLayerCheckList();this.isLayerCollapsedIn=!1}return __extends(i,t),i.prototype.createLayerCheckList=function(){this.layerHeaderList=[];this.layerHeaderList[1]=!0;this.layerHeaderList[2]=!0;this.layerHeaderList[3]=!0;this.layerBodyList=[];this.layerBodyList[0]=!0},i.prototype.updateLayerCheckList=function(){var n=this;$.each(FMM.getLayers().models,function(t,i){n.layerBodyList[parseInt(i.get("id"))]==null&&(n.layerBodyList[parseInt(i.get("id"))]=!0)})},i.prototype.updateLayer=function(){FMV.getMapView().getMarkersView().renderLayers(this.layerBodyList)},i.prototype.setMode=function(n){this.mode=n;this.mode==1?this.setIsLocked(!0):this.setIsLocked(!1)},i.prototype.getMode=function(){return this.mode},i.prototype.resize=function(){FMV.getOrigWidth()<540&&this.$el.css({width:FMV.getOrigWidth()-40})},i.prototype.show=function(n){this.setMode(n);this.setIsOpen(!0);this.$el.removeClass("hidden");this.render()},i.prototype.hide=function(){this.setMode(0);this.setIsOpen(!1);this.$el.addClass("hidden");this.setIsLocked(!1);FMV.getMapView().getMap()&&FMV.getMapView().getMap().dragging.enable()},i.prototype.setIsLocked=function(n){this.isLocked=n},i.prototype.getIsLocked=function(){return this.isLocked},i.prototype.setIsOpen=function(n){this.isOpen=n},i.prototype.getIsOpen=function(){return this.isOpen},i.prototype.getOuterWidth=function(){return this.$el.outerWidth()},i.prototype.render=function(){switch(this.mode){case 2:this.renderUIInfo();break;case 3:this.renderUIDataLayer();break;case 1:this.renderUIAdd();break;case 5:this.renderUILayer();break;case 4:this.renderUIPicture()}},i.prototype.renderUIAdd=function(){var n=this,t=_.template(FMUIAddLayerTemplate),i={header:FML.getViewUIAddHeader(),name:FMC.getSelectedItem().get("name"),desc:FMC.getSelectedItem().get("desc"),type:FMC.getSelectedItem().get("type"),sort:FMC.getSelectedItem().get("sort"),date:FMC.getSelectedItem().get("date"),lat:FMC.getSelectedItem().get("lat"),lng:FMC.getSelectedItem().get("lng"),sort1:FMM.getLayers().where({type:1}),sort2:FMM.getLayers().where({type:2}),sort3:FMM.getLayers().where({type:3})};n.$el.html(t(i));n.$("#item-info-type").selectpicker();n.$("#item-info-amount").off("change");n.$("#item-info-lat").off("change");n.$("#item-info-lng").off("change");n.$("#item-info-btn-edit").off("click");n.$("#item-info-btn-delete").off("click");n.$("#item-info-date-picker").off("dp.change");n.$("#item-info-lat").on("change",function(){FMC.getSelectedItem().set({lat:parseFloat($(this).val())});FMV.getMapView().getMarkersView().updateMarker(FMC.getSelectedItem())});n.$("#item-info-lng").on("change",function(){FMC.getSelectedItem().set({lng:parseFloat($(this).val())});FMV.getMapView().getMarkersView().updateMarker(FMC.getSelectedItem())});n.$("#item-info-type").on("change",function(){var n=$("option:selected",this);FMC.getSelectedItem().set({type:parseInt(n.attr("data-type"))});FMC.getSelectedItem().set({sort:parseInt(n.attr("data-sort"))})});n.$("#item-info-date-picker").datetimepicker({format:FMS.getDateTimeFormat()});n.$("#item-info-date-picker").on("dp.change",function(){FMC.getSelectedItem().set({date:$(this).data("date")});console.log(FMC.getSelectedItem().get("date"))});n.$("#item-info-btn-edit").on("click",function(){FMC.getSelectedItem().get("type")==0?FMV.getMsgView().renderError(FML.getViewUIAddTypeSelectError()):(FMC.getSelectedItem().setIsRemoved(!0),FMV.getMapView().getMarkersView().removeMarker(FMC.getSelectedItem()),FMC.getSelectedItem().save({name:n.$("#item-info-name").val(),desc:n.$("#item-info-desc").val()},{success:function(n){FMV.getMapView().getControlView().resetControls();FMC.hasSelectedItem()&&(FMV.getUIView().hide(),FMV.getMapView().resize(!1),FMC.getSelectedItem().setIsRemoved(!1),FMV.getMapView().getMarkersView().render(),FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewUIInfoSaveSuccessMsg()))},error:function(){FMV.getMsgView().renderError(FML.getViewUIInfoSaveErrorMsg())}}))});n.$("#item-info-btn-delete").on("click",function(){if(FMV.getMapView().getControlView().resetControls(),FMC.hasSelectedItem()){var n=FMC.removeItem(FMC.getSelectedItem());n.setIsRemoved(!0);FMV.getMapView().getMarkersView().removeMarker(n);FMC.setSelectedItem(null);FMV.getUIView().hide();FMV.getMapView().resize(!1)}})},i.prototype.renderUIInfo=function(){var n=this,t=_.template(FMUIInfoLayerTemplate),i={header:FML.getViewUIInfoHeader(),id:FMC.getSelectedItem().get("id"),name:FMC.getSelectedItem().get("name"),desc:FMC.getSelectedItem().get("desc"),amount:FMC.getSelectedItem().get("amount"),type:FMC.getSelectedItem().get("type"),sort:FMC.getSelectedItem().get("sort"),lat:FMC.getSelectedItem().get("lat"),lng:FMC.getSelectedItem().get("lng"),date:FMC.getSelectedItem().get("date"),update:FMC.getSelectedItem().get("update"),sort1:FMM.getLayers().where({type:1}),sort2:FMM.getLayers().where({type:2}),sort3:FMM.getLayers().where({type:3})};n.$el.html(t(i));n.$("#item-info-type").selectpicker();n.$("#item-info-type option").each(function(){FMC.getSelectedItem().get("type")==$(this).attr("data-type")&&FMC.getSelectedItem().get("sort")==$(this).attr("data-sort")&&n.$("#item-info-type").selectpicker("val",$(this).val())});n.$("#item-info-amount").off("change");n.$("#item-info-lat").off("change");n.$("#item-info-lng").off("change");n.$("#item-info-btn-edit").off("click");n.$("#item-info-btn-delete").off("click");n.$("#item-info-date-picker").off("dp.change");n.$("#item-info-amount").on("change",function(){FMC.getSelectedItem().save({amount:parseFloat($(this).val())},{success:function(n){FMV.getMapView().getMarkersView().updateMarker(FMC.getSelectedItem());FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewUIInfoSaveSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewUIInfoSaveErrorMsg())}})});n.$("#item-info-lat").on("change",function(){FMC.getSelectedItem().save({lat:parseFloat($(this).val())},{success:function(n){FMV.getMapView().getMarkersView().updateMarker(FMC.getSelectedItem());FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewUIInfoSaveSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewUIInfoSaveErrorMsg())}})});n.$("#item-info-lng").on("change",function(){FMC.getSelectedItem().save({lng:parseFloat($(this).val())},{success:function(n){FMV.getMapView().getMarkersView().updateMarker(FMC.getSelectedItem());FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewUIInfoSaveSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewUIInfoSaveErrorMsg())}})});n.$("#item-info-date-picker").datetimepicker({format:FMS.getDateTimeFormat()});n.$("#item-info-date-picker").on("dp.change",function(){FMC.getSelectedItem().set({date:$(this).data("date")});console.log(FMC.getSelectedItem().get("date"))});n.$("#item-info-btn-edit").on("click",function(){var t=$("option:selected",n.$("#item-info-type"));parseInt(t.attr("data-type"))!=0&&parseInt(t.attr("data-sort"))!=0?(FMV.getMapView().getMarkersView().removeMarker(FMC.getSelectedItem()),FMC.getSelectedItem().save({id:n.$("#item-info-id").val(),name:n.$("#item-info-name").val(),desc:n.$("#item-info-desc").val(),type:parseInt(t.attr("data-type")),sort:parseInt(t.attr("data-sort")),amount:n.$("#item-info-amount").val(),lat:n.$("#item-info-lat").val(),lng:n.$("#item-info-lng").val()},{success:function(n){FMV.getMapView().getMarkersView().render();FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewUIInfoSaveSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewUIInfoSaveErrorMsg())}})):FMV.getMsgView().renderError(FML.getViewUIAddTypeSelectError())});n.$("#item-info-btn-delete").on("click",function(){var n=confirm(FML.getViewUIInfoDeleteConfirmMsg());n==!0&&FMC.getSelectedItem().destroy({wait:!0,success:function(n){n.setIsRemoved(!0);FMM.getItems().remove(n);FMV.getMapView().getMarkersView().removeMarker(n);FMV.getMapView().getControlView().resetControls();FMV.getUIView().hide();FMV.getMapView().resize(!1);FMV.getMapView().getMarkersView().render();FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewUIInfoDeleteSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewUIInfoDeleteErrorMsg())}})})},i.prototype.renderUIPicture=function(){var t,r,u,f;FMC.fetchPictures(parseInt(FMC.getSelectedItem().get("id")));var i=this,e=_.template(FMViewUILayerPictureTemplate),o={header:FML.getViewUIPictureHeader()};i.$el.html(e(o));t=new Backgrid.Grid({columns:pictureColumn,collection:FMM.getPictures(),emptyText:FML.getViewUIDataNoDataMsg()});t.render();t.sort("date","descending");i.$(".ui-body").append(t.el);setTimeout(function(){t.sort("date","descending")},3e3);r=new n.Picture({pid:parseInt(FMC.getSelectedItem().get("id")),date:moment(new Date).format(FMS.getDateTimeFormat()),update:moment(new Date).format(FMS.getDateTimeFormat())});r.setIsSavable(!1);u=new n.Pictures;u.add(r);f=new Backgrid.Grid({columns:pictureAddColumn,collection:u,emptyText:FML.getViewUIDataNoDataMsg()});i.$("#picture-add-panel").append(f.render().el)},i.prototype.renderUILayer=function(){var t=this,f="",e,o,i,r,u,s;t.isLayerCollapsedIn&&(f="in");e=_.template(FMViewLayerTemplate);o={header:FML.getViewUILayerHeader(),isIn:f,sort1:FMM.getLayers().where({type:1}),sort2:FMM.getLayers().where({type:2}),sort3:FMM.getLayers().where({type:3})};t.$el.html(e(o));t.updateLayerCheckList();t.layerHeaderList[1]?$("#check-event-layer").prop({checked:!0}):$("#check-event-layer").prop({checked:!1});t.layerHeaderList[2]?$("#check-organization-layer").prop({checked:!0}):$("#check-organization-layer").prop({checked:!1});t.layerHeaderList[3]?$("#check-donor-layer").prop({checked:!0}):$("#check-donor-layer").prop({checked:!1});$("#check-event-layer").click(function(){t.layerHeaderList[1]=$(this).prop("checked");$(this).prop("checked")?$('input[type="checkbox"][data-type="1"]',t.$el).each(function(){$(this).prop({checked:!0});t.layerBodyList[parseInt($(this).attr("data-sort"))]=$(this).prop("checked")}):$('input[type="checkbox"][data-type="1"]',t.$el).each(function(){$(this).prop({checked:!1});t.layerBodyList[parseInt($(this).attr("data-sort"))]=$(this).prop("checked")})});$("#check-organization-layer").click(function(){t.layerHeaderList[2]=$(this).prop("checked");$(this).prop("checked")?$('input[type="checkbox"][data-type="2"]',t.$el).each(function(){$(this).prop({checked:!0});t.layerBodyList[parseInt($(this).attr("data-sort"))]=$(this).prop("checked")}):$('input[type="checkbox"][data-type="2"]',t.$el).each(function(){$(this).prop({checked:!1});t.layerBodyList[parseInt($(this).attr("data-sort"))]=$(this).prop("checked")})});$("#check-donor-layer").click(function(){t.layerHeaderList[3]=$(this).prop("checked");$(this).prop("checked")?$('input[type="checkbox"][data-type="3"]',t.$el).each(function(){$(this).prop({checked:!0});t.layerBodyList[parseInt($(this).attr("data-sort"))]=$(this).prop("checked")}):$('input[type="checkbox"][data-type="3"]',t.$el).each(function(){$(this).prop({checked:!1});t.layerBodyList[parseInt($(this).attr("data-sort"))]=$(this).prop("checked")})});t.layerBodyList[0]?$("#check-unassigned-layer").prop({checked:!0}):$("#check-unassigned-layer").prop({checked:!1});$("#check-unassigned-layer").click(function(){t.layerBodyList[parseInt($(this).attr("data-sort"))]=$(this).prop("checked")});$('input[type="checkbox"]',t.$el).each(function(){t.layerBodyList[parseInt($(this).attr("data-sort"))]?$(this).prop({checked:!0}):$(this).prop({checked:!1})});$('input[type="checkbox"]',t.$el).click(function(){t.layerBodyList[parseInt($(this).attr("data-sort"))]=$(this).prop("checked");t.updateLayer()});t.$('button[data-target="#layer-add-panel"]').click(function(){t.isLayerCollapsedIn=!t.isLayerCollapsedIn});layerColumn[0].cell=Backgrid.SelectCell.extend({optionValues:FMM.getTypes().toArray()});i=new Backgrid.Grid({columns:layerColumn,collection:FMM.getLayers(),emptyText:FML.getViewUIDataNoDataMsg()});i.render();i.sort("name","ascending");t.$(".ui-body #layer-list-grid").append(i.el);layerAddColumn[0].cell=Backgrid.SelectCell.extend({optionValues:FMM.getTypes().toArray()});r=new n.Layer({name:"",desc:"",type:1});r.setIsSavable(!1);u=new n.Layers;u.add(r);s=new Backgrid.Grid({columns:layerAddColumn,collection:u,emptyText:FML.getViewUIDataNoDataMsg()});t.$(".ui-body #layer-add-grid").append(s.render().el)},i.prototype.renderUIDataLayer=function(){var i=this,t,f,e,o,s,r,u;parseInt(FMC.getSelectedItem().get("type"))!=3?(r=_.template(FMViewUIDataTemplate),u={header:FML.getViewUIDataHeader()},i.$el.html(r(u)),t=new n.Items,t.add(FMM.getItems().where({type:2})),t.add(FMM.getItems().where({type:3})),dataColumn[0].cell=Backgrid.SelectCell.extend({optionValues:t.toArray()}),f=new Backgrid.Grid({columns:dataColumn,collection:new n.Gives(FMM.getGives().where({tid:FMC.getSelectedItem().get("id")})),emptyText:FML.getViewUIDataNoDataMsg()}),f.render(),f.sort("date","descending"),i.$(".ui-body").append(f.el),dataAddColumn[0].cell=Backgrid.SelectCell.extend({optionValues:t.toArray()}),e=new n.Give({tid:FMC.getSelectedItem().get("id"),gid:0,name:"",desc:"",amount:0,date:moment(new Date).format(FMS.getDateTimeFormat()),update:moment(new Date).format(FMS.getDateTimeFormat())}),e.setIsSavable(!1),o=new n.Gives,o.add(e),s=new Backgrid.Grid({columns:dataAddColumn,collection:o,emptyText:FML.getViewUIDataNoDataMsg()}),i.$(".ui-body #data-add-panel").append(s.render().el)):(r=_.template(FMViewUIDataTemplateDonor),u={header:FML.getViewUIDataHeader()},i.$el.html(r(u)))},i}(Backbone.View);n.UIView=t}(ForagingMap||(ForagingMap={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var t=function(t){function i(i){var r;t.call(this,i);r=this;this.isSelectable=!1;r.markerGroups=[];r.circleGroups=[];r.pathGroups=[];var u=new L.FeatureGroup,f=new L.FeatureGroup,e=new L.FeatureGroup;u.sid=0;f.sid=0;e.sid=0;r.markerGroups.push(u);r.circleGroups.push(f);r.pathGroups.push(e);$.each(FMM.getLayers().models,function(n,t){var i=new L.FeatureGroup,u=new L.FeatureGroup,f=new L.FeatureGroup;i.sid=parseInt(t.id);u.sid=parseInt(t.id);r.markerGroups.push(i);r.circleGroups.push(u);r.pathGroups.push(f)});$.each(r.markerGroups,function(n,t){t.addTo(FMV.getMapView().getMap())});$.each(r.circleGroups,function(n,t){t.addTo(FMV.getMapView().getMap())});$.each(r.pathGroups,function(n,t){t.addTo(FMV.getMapView().getMap())});r.iconBlank=new L.Icon({iconUrl:n.Setting.BASE_URL+FMS.getImageDir()+FMS.getImageMarkerBlank(),shadowUrl:n.Setting.BASE_URL+FMS.getImageDir()+FMS.getImageMarkerShadow(),iconSize:new L.Point(40,40),iconAnchor:new L.Point(20,40),shadowAnchor:new L.Point(9,38),popupAnchor:new L.Point(0,-40)});r.iconHeart=new L.Icon({iconUrl:n.Setting.BASE_URL+FMS.getImageDir()+FMS.getImageMarkerHeart(),shadowUrl:n.Setting.BASE_URL+FMS.getImageDir()+FMS.getImageMarkerShadow(),iconSize:new L.Point(40,40),iconAnchor:new L.Point(20,40),shadowAnchor:new L.Point(9,38),popupAnchor:new L.Point(0,-40)});r.iconDollar=new L.Icon({iconUrl:n.Setting.BASE_URL+FMS.getImageDir()+FMS.getImageMarkerDollar(),shadowUrl:n.Setting.BASE_URL+FMS.getImageDir()+FMS.getImageMarkerShadow(),iconSize:new L.Point(40,40),iconAnchor:new L.Point(20,40),shadowAnchor:new L.Point(9,38),popupAnchor:new L.Point(0,-40)});r.iconNew=new L.Icon({iconUrl:n.Setting.BASE_URL+FMS.getImageDir()+FMS.getImageMarkerNew(),shadowUrl:n.Setting.BASE_URL+FMS.getImageDir()+FMS.getImageMarkerShadow(),iconSize:new L.Point(40,40),iconAnchor:new L.Point(20,40),shadowAnchor:new L.Point(9,38),popupAnchor:new L.Point(0,-40)})}return __extends(i,t),i.prototype.render=function(){var n=this;$.each(FMM.getItems().models,function(t,i){if(!i.getIsRemoved())if(i.marker==null&&i.circle==null){i.get("type")==0?(i.marker=new L.Marker(new L.LatLng(parseFloat(i.get("lat")),parseFloat(i.get("lng"))),{icon:n.iconNew,draggable:!1,riseOnHover:!0}).bindPopup(i.get("name"),{closeButton:!1}),i.circle=new L.Circle(new L.LatLng(parseFloat(i.get("lat")),parseFloat(i.get("lng"))),parseFloat(i.get("amount"))*FMS.getCircleRadiusMultiplier(),{color:FMS.getTempCircleColor(),fillColor:FMS.getTempCircleColor(),fillOpacity:FMS.getInactiveAlpha(),weight:1})):i.get("type")==1?(i.marker=new L.Marker(new L.LatLng(parseFloat(i.get("lat")),parseFloat(i.get("lng"))),{icon:n.iconBlank,draggable:!1,riseOnHover:!0}).bindPopup(i.get("name"),{closeButton:!1}),i.circle=new L.Circle(new L.LatLng(parseFloat(i.get("lat")),parseFloat(i.get("lng"))),parseFloat(i.get("amount"))*FMS.getCircleRadiusMultiplier(),{color:FMS.getEventCircleColor(),fillColor:FMS.getEventCircleColor(),fillOpacity:FMS.getInactiveAlpha(),weight:1})):i.get("type")==2?(i.marker=new L.Marker(new L.LatLng(parseFloat(i.get("lat")),parseFloat(i.get("lng"))),{icon:n.iconDollar,draggable:!1,riseOnHover:!0}).bindPopup(i.get("name"),{closeButton:!1}),i.circle=new L.Circle(new L.LatLng(parseFloat(i.get("lat")),parseFloat(i.get("lng"))),parseFloat(i.get("amount"))*FMS.getCircleRadiusMultiplier(),{color:FMS.getOrganizationCircleColor(),fillColor:FMS.getOrganizationCircleColor(),fillOpacity:FMS.getInactiveAlpha(),weight:1})):i.get("type")==3&&(i.marker=new L.Marker(new L.LatLng(parseFloat(i.get("lat")),parseFloat(i.get("lng"))),{icon:n.iconHeart,draggable:!1,riseOnHover:!0}).bindPopup(i.get("name"),{closeButton:!1}),i.circle=new L.Circle(new L.LatLng(parseFloat(i.get("lat")),parseFloat(i.get("lng"))),parseFloat(i.get("amount"))*FMS.getCircleRadiusMultiplier(),{color:FMS.getDonorCircleColor(),fillColor:FMS.getDonorCircleColor(),fillOpacity:FMS.getInactiveAlpha(),weight:1}));i.marker.setOpacity(FMS.getHalfAlpha());var r=n.getIndexOfMarkerGroups(i);n.markerGroups[r].addLayer(i.marker);n.circleGroups[r].addLayer(i.circle);n.removeEventListener(i);n.addEventListener(i)}else n.updateMarker(i)});FMC.getSelectedItem()!=null&&FMC.getSelectedItem().marker!=null&&FMC.getSelectedItem().marker.openPopup()},i.prototype.getIndexOfMarkerGroups=function(n){var i=this,t;return n.id==undefined?0:(t=0,$.each(i.markerGroups,function(i,r){if(r.sid==parseInt(n.get("sort")))return t=i}),t)},i.prototype.getIndexOfMarkerGroups2=function(n){var i=this,t=0;return $.each(i.markerGroups,function(i,r){if(r.sid==n)return t=i}),t},i.prototype.createNewMarkerLayer=function(n){var t=this,i=new L.FeatureGroup,r=new L.FeatureGroup,u=new L.FeatureGroup;i.sid=parseInt(n.id);r.sid=parseInt(n.id);u.sid=parseInt(n.id);t.markerGroups.push(i);t.circleGroups.push(r);t.pathGroups.push(u)},i.prototype.updateMarker=function(n){n.marker.setPopupContent(n.get("name"));var t=new L.LatLng(parseFloat(n.get("lat")),parseFloat(n.get("lng")));n.marker.setLatLng(t);n.circle.setLatLng(t);n.circle.setRadius(parseFloat(n.get("amount"))*FMS.getCircleRadiusMultiplier())},i.prototype.removeMarker=function(n){var t=this.getIndexOfMarkerGroups(n);n.marker!=null&&this.markerGroups[t].hasLayer(n.marker)&&this.markerGroups[t].removeLayer(n.marker);n.circle!=null&&this.circleGroups[t].hasLayer(n.circle)&&this.circleGroups[t].removeLayer(n.circle);n.marker=null;n.circle=null},i.prototype.removeEventListener=function(n){n.marker.off("click");n.marker.off("popupclose");n.marker.off("popupopen");n.marker.off("dragstart");n.marker.off("drag");n.marker.off("dragend")},i.prototype.getIsSelectable=function(){return this.isSelectable},i.prototype.setIsSelectable=function(n){this.isSelectable=n},i.prototype.addEventListener=function(n){var t=this;n.marker.on("click",function(){t.isSelectable&&(FMV.getUIView().getIsLocked()&&n.get("type")!=0||(this.openPopup(),FMV.getUIView().render()))});n.marker.on("popupclose",function(){});n.marker.on("popupopen",function(){t.isSelectable&&(FMC.setSelectedItem(n),t.render(),t.activateMarker(n))});n.marker.on("dragstart",function(){});n.marker.on("drag",function(){n.circle.setLatLng(n.marker.getLatLng())});n.marker.on("dragend",function(){n.get("type")==0||n.id==undefined?n.set({lat:n.marker.getLatLng().lat,lng:n.marker.getLatLng().lng}):n.save({lat:n.marker.getLatLng().lat,lng:n.marker.getLatLng().lng},{success:function(n){FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewMarkerSaveSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewMarkerSaveErrorMsg())}});t.renderPaths()})},i.prototype.activateMarker=function(){var n=this;$.each(FMM.getItems().models,function(t,i){i.marker!=null&&i.circle!=null&&(FMC.getSelectedItem()==i?(FMV.getMapView().SetIsMapPanZoomAvailable(!1),i.marker.bounce({duration:200,height:10},function(){i.marker.setOpacity(FMS.getFullAlpha());i.circle.setStyle({fillOpacity:FMS.getActiveAlpha()});var t=n.getIndexOfMarkerGroups(i);n.markerGroups[t].bringToFront();n.circleGroups[t].bringToFront();FMV.getMapView().SetIsMapPanZoomAvailable(!0);i.marker.dragging.enable();i.marker.off("dblclick");i.marker.on("dblclick",function(){FMC.getSelectedItem()==i&&FMC.getRouter().navigate("map/"+FMS.getLocateZoom()+"/"+parseFloat(i.get("lat"))+"/"+parseFloat(i.get("lng")),{trigger:!0,replace:!0})})})):(i.marker.off("dblclick"),i.marker.dragging.disable(),i.marker.setOpacity(FMS.getInactiveAlpha()),i.circle.setStyle({fillOpacity:FMS.getInactiveAlpha()})))});n.renderPaths()},i.prototype.inactiveMarkers=function(){var n=this;FMC.getSelectedItem()&&FMC.getSelectedItem().marker.closePopup();FMC.setSelectedItem(null);FMV.getUIView().hide();$.each(FMM.getItems().models,function(n,t){t.marker!=null&&t.circle!=null&&(t.marker.off("dblclick"),t.marker.dragging.disable(),t.marker.setOpacity(FMS.getInactiveAlpha()),t.circle.setStyle({fillOpacity:FMS.getInactiveAlpha()}))});n.renderPaths()},i.prototype.renderLayers=function(n){var t=this;$.each(n,function(n,i){if(i!=undefined){var r=t.getIndexOfMarkerGroups2(n);i?(FMV.getMapView().getMap().addLayer(t.circleGroups[r]),FMV.getMapView().getMap().addLayer(t.markerGroups[r])):(FMV.getMapView().getMap().hasLayer(t.circleGroups[r])&&FMV.getMapView().getMap().removeLayer(t.circleGroups[r]),FMV.getMapView().getMap().hasLayer(t.markerGroups[r])&&FMV.getMapView().getMap().removeLayer(t.markerGroups[r]))}});t.renderPaths()},i.prototype.hidePaths=function(){var n=this;$.each(n.pathGroups,function(n,t){t.clearLayers()})},i.prototype.renderPaths=function(){var n=this;n.hidePaths();$.each(FMM.getGives().models,function(t,i){var f=FMM.getItems().get(i.get("gid")),u=FMM.getItems().get(i.get("tid")),r;if(f!=null&&u!=null){var e=new L.LatLng(parseFloat(f.get("lat")),parseFloat(f.get("lng"))),o=new L.LatLng(parseFloat(u.get("lat")),parseFloat(u.get("lng"))),s=n.getIndexOfMarkerGroups(u);FMV.getMapView().getMap().hasLayer(n.pathGroups[s])&&(u==FMC.getSelectedItem()?(r=new L.Polyline([e,o],{weight:4,color:"#34495e",opacity:.7}),r.setText("  ►  ",{repeat:!0,attributes:{fill:"#2c3e50",opacity:1}})):f==FMC.getSelectedItem()?(r=new L.Polyline([e,o],{weight:4,color:"#34495e",opacity:.3}),r.setText("  ►  ",{repeat:!0,attributes:{fill:"#2c3e50",opacity:.5}})):(r=new L.Polyline([e,o],{weight:4,color:"#34495e",opacity:.075}),r.setText("  ►  ",{repeat:!0,attributes:{fill:"#2c3e50",opacity:.075}})),r.addTo(n.pathGroups[s]))}})},i}(Backbone.View);n.MarkersView=t}(ForagingMap||(ForagingMap={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var t=function(n){function t(t){n.call(this,t);this.setElement(t.el)}return __extends(t,n),t.prototype.renderError=function(n){var t=this,i=_.template(FMMsgViewErrorTemplate),r={msg:n};t.$el.html(i(r));t.timeout!=null&&clearTimeout(t.timeout);t.timeout=setTimeout(function(){t.$el.html("")},FMS.getMsgTimeout())},t.prototype.renderSuccess=function(n){var t=this,i=_.template(FMMsgViewSuccessTemplate),r={msg:n};t.$el.html(i(r));t.timeout!=null&&clearTimeout(t.timeout);t.timeout=setTimeout(function(){t.$el.html("")},FMS.getMsgTimeout())},t}(Backbone.View);n.MsgView=t}(ForagingMap||(ForagingMap={}));FMMsgViewErrorTemplate="";FMMsgViewErrorTemplate+='<span class="label label-warning"><%= msg %><\/span>';FMMsgViewSuccessTemplate="";FMMsgViewSuccessTemplate+='<span class="label label-success"><%= msg %><\/span>';__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var t=function(n){function t(t){n.call(this,t);this.setElement(t.el);this.render()}return __extends(t,n),t.prototype.render=function(){var n=this,t=_.template(FMMapControlViewTemplate);n.$el.html(t({}));n.removeEventListener();n.addEventListener()},t.prototype.removeEventListener=function(){var n=this;n.$(".control-button").off("mouseenter");n.$(".control-button").off("mouseleave");n.$(".control-button.zoomin").off("click");n.$(".control-button.zoomout").off("click");n.$(".control-button.locate").off("click");n.$(".control-button.layer").off("click");n.$(".control-button.info").off("click");n.$(".control-button.add").off("click");n.$(".control-button.data").off("click");n.$(".control-button.picture").off("click")},t.prototype.addEventListener=function(){var n=this;n.$(".control-button").on("mouseenter",function(){FMV.getMapView().SetIsMapPanZoomAvailable(!1)});n.$(".control-button").on("mouseleave",function(){FMV.getMapView().SetIsMapPanZoomAvailable(!0)});n.$(".control-button.zoomin").on("click",function(){FMV.getMapView().getMap().zoomIn()});n.$(".control-button.zoomout").on("click",function(){FMV.getMapView().getMap().zoomOut()});n.$(".control-button.locate").on("click",function(){FMV.getUIView().getIsLocked()||navigator.geolocation&&navigator.geolocation.getCurrentPosition(n.updatePosition)});n.$(".control-button.layer").on("click",function(){FMV.getUIView().getIsLocked()||($(this).hasClass("layer-active")?($(this).removeClass("layer-active"),FMV.getUIView().hide()):(n.resetControls(),$(this).addClass("layer-active"),FMV.getUIView().show(5)),FMV.getMapView().resize(!1))});n.$(".control-button.info").on("click",function(){FMV.getUIView().getIsLocked()||($(this).hasClass("info-active")?($(this).removeClass("info-active"),FMV.getUIView().hide(),FMV.getMapView().resize(!1)):FMC.hasSelectedItem()?(n.resetControls(),$(this).addClass("info-active"),FMV.getUIView().show(2),FMV.getMapView().resize(!0)):FMV.getMsgView().renderError(FML.getViewUIItemNotSelectedErrorMsg()))});n.$(".control-button.add").on("click",function(){if($(this).hasClass("add-active")){if($(this).removeClass("add-active"),FMC.hasSelectedItem()){var t=FMC.removeItem(FMC.getSelectedItem());FMV.getMapView().getMarkersView().removeMarker(t);FMC.setSelectedItem(null);FMV.getUIView().hide();FMV.getMapView().resize(!1)}}else n.resetControls(),$(this).addClass("add-active"),FMC.setSelectedItem(FMC.createItem()),FMV.getUIView().show(1),FMV.getMapView().resize(!0),setTimeout(function(){FMV.getMapView().getMarkersView().render()},500)});n.$(".control-button.data").on("click",function(){FMV.getUIView().getIsLocked()||($(this).hasClass("data-active")?($(this).removeClass("data-active"),FMV.getUIView().hide(),FMV.getMapView().resize(!1)):FMC.hasSelectedItem()&&parseInt(FMC.getSelectedItem().get("type"))!=3?FMC.hasSelectedItem()?(n.resetControls(),$(this).addClass("data-active"),FMV.getUIView().show(3),FMV.getMapView().resize(!0)):FMV.getMsgView().renderError(FML.getViewUIItemNotSelectedErrorMsg()):FMV.getMsgView().renderError(FML.getViewUIDataDonorNoAccessMsg()))});n.$(".control-button.picture").on("click",function(){FMV.getUIView().getIsLocked()||($(this).hasClass("picture-active")?($(this).removeClass("picture-active"),FMV.getUIView().hide(),FMV.getMapView().resize(!1)):FMC.hasSelectedItem()?(n.resetControls(),$(this).addClass("picture-active"),FMV.getUIView().show(4),FMV.getMapView().resize(!0)):FMV.getMsgView().renderError(FML.getViewUIItemNotSelectedErrorMsg()))})},t.prototype.resetControls=function(){var n=this;n.$(".control-button.layer").removeClass("layer-active");n.$(".control-button.info").removeClass("info-active");n.$(".control-button.add").removeClass("add-active");n.$(".control-button.layer").removeClass("layer-active");n.$(".control-button.picture").removeClass("picture-active");n.$(".control-button.data").removeClass("data-active")},t.prototype.updatePosition=function(n){var t=this;FMC.getRouter().navigate("map/"+FMS.getLocateZoom()+"/"+n.coords.latitude+"/"+n.coords.longitude,{trigger:!0,replace:!0});FMV.getMsgView().renderSuccess(FML.getViewUILocateSuccessMsg())},t}(Backbone.View);n.MapControlView=t}(ForagingMap||(ForagingMap={}));FMMapControlViewTemplate="";FMMapControlViewTemplate+='<div class="leaflet-control">';FMMapControlViewTemplate+='<div class="control-button zoomin"><\/div>';FMMapControlViewTemplate+='<div class="control-button zoomout"><\/div>';FMMapControlViewTemplate+='<div class="control-button locate"><\/div>';FMMapControlViewTemplate+='<div class="control-button layer"><\/div>';FMMapControlViewTemplate+='<div class="control-button info"><\/div>';FMMapControlViewTemplate+='<div class="control-button data"><\/div>';FMMapControlViewTemplate+='<div class="control-button picture"><\/div>';FMMapControlViewTemplate+='<div class="control-button add"><\/div>';FMMapControlViewTemplate+="<\/div>";__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var t=function(n){function t(t){n.call(this,t);this.setElement(t.el);Galleria.loadTheme("core/lib/galleria/themes/classic/galleria.classic.js");$("#leaflet-view-galleria").css({width:$("#fm-view-map").innerWidth(),height:$("#fm-view-map").innerHeight()+1})}return __extends(t,n),t.prototype.render=function(){var n=this,t=_.template(FMViewGalleryTemplate),i={pictures:FMM.getPictures().models,dir:FMS.getBaseUrl()+FMS.getPictureDir()};n.$el.html(t(i))},t.prototype.show=function(n){var t=this;t.$el.addClass("galleria-show");Galleria.run(".galleria",{show:n,imageCrop:!1,transition:"fade"});Galleria.ready(function(){$("#btn-galleria-close").off("click");$("#btn-galleria-close").on("click",function(){t.hide();t.$el.html("")})})},t.prototype.hide=function(){var n=this;n.$el.removeClass("galleria-show")},t}(Backbone.View);n.GalleryView=t}(ForagingMap||(ForagingMap={})),function(n){var t=function(){function t(){this.layers=new n.Layers;this.items=new n.Items;this.gives=new n.Gives;this.pictures=new n.Pictures;this.types=new n.Types;this.types.add(new n.Type({name:"Event",type:1}));this.types.add(new n.Type({name:"Organization",type:2}));this.types.add(new n.Type({name:"Donor",type:3}))}return t.prototype.getTypes=function(){return this.types},t.prototype.getLayers=function(){return this.layers},t.prototype.getItems=function(){return this.items},t.prototype.getPictures=function(){return this.pictures},t.prototype.getGives=function(){return this.gives},t}();n.Model=t}(ForagingMap||(ForagingMap={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){n[n.None=0]="None";n[n.Event=1]="Event";n[n.Organization=2]="Organization";n[n.Donor=3]="Donor"}(ItemType||(ItemType={})),function(n){var t=function(t){function i(i,r){t.call(this,i,r);this.isRemoved=!1;this.url="core/php/item.php";this.url=n.Setting.BASE_URL+this.url;this.defaults={name:"",desc:"",type:0,sort:0,amount:0,lat:0,lng:0,date:moment(new Date).format(FMS.getDateTimeFormat()),update:moment(new Date).format(FMS.getDateTimeFormat())}}return __extends(i,t),i.prototype.parse=function(n,i){return n.id!=null&&(n.id=parseInt(n.id)),n.type=parseInt(n.type),n.sort=parseInt(n.sort),n.amount=parseFloat(n.amount),n.lat=parseFloat(n.lat),n.lng=parseFloat(n.lng),n.date=moment(n.date).format(FMS.getDateTimeFormat()),n.update=moment(n.update).format(FMS.getDateTimeFormat()),t.prototype.parse.call(this,n,i)},i.prototype.toJSON=function(){var n=this.clone().attributes;return this.id!=null&&(n.id=this.id),n},i.prototype.setIsRemoved=function(n){this.isRemoved=n},i.prototype.getIsRemoved=function(){return this.isRemoved},i}(Backbone.Model),i;n.Item=t;i=function(i){function r(r,u){i.call(this,r,u);this.url="core/php/items.php";this.model=t;this.url=n.Setting.BASE_URL+this.url}return __extends(r,i),r.prototype.getIds=function(){var t=this,n=[];return $.each(t.models,function(t,i){n.push(i.id)}),n},r.prototype.getIdsToString=function(){var t=this,n=[];return $.each(t.models,function(t,i){n.push(parseInt(i.id))}),n.sort(function(n,t){return n-t}).join(",")},r.prototype.toArray=function(){var t=this,n;return t.sort(),n=[],_.each(t.models,function(t){n.push([t.get("name"),t.id])}),n},r.prototype.comparator=function(n){return n.get("name")},r}(Backbone.Collection);n.Items=i}(ForagingMap||(ForagingMap={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var i=function(t){function i(i,r){t.call(this,i,r);this.url="core/php/layer.php";this.isSavable=!0;var u=this;u.url=n.Setting.BASE_URL+u.url;u.defaults={name:"",desc:"",type:0};u.off("change");u.on("change",function(n){u.isSavable!=!1&&(n.save(),FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewUIInfoSaveSuccessMsg()),FMV.getUIView().render())})}return __extends(i,t),i.prototype.parse=function(n,i){return n.id!=null&&(n.id=parseInt(n.id)),n.type=parseInt(n.type),t.prototype.parse.call(this,n,i)},i.prototype.toJSON=function(){var n=this.clone().attributes;return this.id!=null&&(n.id=this.id),n},i.prototype.setIsSavable=function(n){this.isSavable=n},i.prototype.getIsSavable=function(){return this.isSavable},i}(Backbone.Model),r,t,u;n.Layer=i;r=function(t){function r(r,u){t.call(this,r,u);this.url="core/php/layers.php";this.model=i;this.url=n.Setting.BASE_URL+this.url}return __extends(r,t),r.prototype.getSizeOfType=function(n){var i=this,t=0;return $.each(i.models,function(i,r){parseInt(r.get("type"))==n&&t++}),t},r}(Backbone.Collection);n.Layers=r;t=function(n){function t(t,i){n.call(this,t,i);this.defaults={name:"",type:0}}return __extends(t,n),t.prototype.parse=function(t,i){return t.id!=null&&(t.id=parseInt(t.id)),t.type=parseInt(t.type),n.prototype.parse.call(this,t,i)},t.prototype.toJSON=function(){var n=this.clone().attributes;return this.id!=null&&(n.id=this.id),n},t}(Backbone.Model);n.Type=t;u=function(n){function i(i,r){n.call(this,i,r);this.model=t}return __extends(i,n),i.prototype.toArray=function(){var t=this,n=[];return _.each(t.models,function(t){n.push([t.get("name"),t.get("type")])}),n},i}(Backbone.Collection);n.Types=u}(ForagingMap||(ForagingMap={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var t=function(t){function i(i,r){t.call(this,i,r);this.url="core/php/picture.php";this.isSavable=!0;var u=this;this.url=n.Setting.BASE_URL+this.url;this.defaults={pid:0,name:"",url:"",date:moment(new Date).format(FMS.getDateTimeFormat()),update:moment(new Date).format(FMS.getDateTimeFormat())};u.off("change");u.on("change",function(n){u.isSavable!=!1&&(u.isSavable=!1,n.save({},{success:function(n){n.isSavable=!0;FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewUIDataSaveSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewUIInfoSaveErrorMsg())}}))})}return __extends(i,t),i.prototype.parse=function(n,i){return n.id!=null&&(n.id=parseInt(n.id)),n.pid=parseInt(n.pid),n.date=moment(n.date).format(FMS.getDateTimeFormat()),n.update=moment(n.update).format(FMS.getDateTimeFormat()),t.prototype.parse.call(this,n,i)},i.prototype.toJSON=function(){var n=this.clone().attributes;return this.id!=null&&(n.id=this.id),n},i.prototype.setIsSavable=function(n){this.isSavable=n},i.prototype.getIsSavable=function(){return this.isSavable},i}(Backbone.Model),i;n.Picture=t;i=function(i){function r(r,u){i.call(this,r,u);this.url="core/php/pictures.php";this.model=t;this.url=n.Setting.BASE_URL+this.url}return __extends(r,i),r}(Backbone.Collection);n.Pictures=i}(ForagingMap||(ForagingMap={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var t=function(t){function i(i,r){t.call(this,i,r);this.url="core/php/give.php";this.isSavable=!0;var u=this;this.url=n.Setting.BASE_URL+this.url;this.defaults={tid:0,gid:0,name:"",desc:"",amount:"",date:moment(new Date).format(FMS.getDateTimeFormat()),update:moment(new Date).format(FMS.getDateTimeFormat())};u.off("change");u.on("change",function(n){u.isSavable!=!1&&(u.isSavable=!1,n.save({},{success:function(n){n.isSavable=!0;FMC.fetchItems(FMV.getMapView().getMapBounds());FMV.getMsgView().renderSuccess("'"+n.get("name")+"' "+FML.getViewUIDataSaveSuccessMsg())},error:function(){FMV.getMsgView().renderError(FML.getViewUIInfoSaveErrorMsg())}}))})}return __extends(i,t),i.prototype.parse=function(n,i){return n.id!=null&&(n.id=parseInt(n.id)),n.tid=parseInt(n.tid),n.gid=parseInt(n.gid),n.amount=parseFloat(n.amount),n.date=moment(n.date).format(FMS.getDateTimeFormat()),n.update=moment(n.update).format(FMS.getDateTimeFormat()),t.prototype.parse.call(this,n,i)},i.prototype.toJSON=function(){var n=this.clone().attributes;return this.id!=null&&(n.id=this.id),n},i.prototype.setIsSavable=function(n){this.isSavable=n},i.prototype.getIsSavable=function(){return this.isSavable},i}(Backbone.Model),i;n.Give=t;i=function(i){function r(r,u){i.call(this,r,u);this.url="core/php/gives.php";this.model=t;this.url=n.Setting.BASE_URL+this.url}return __extends(r,i),r}(Backbone.Collection);n.Gives=i}(ForagingMap||(ForagingMap={}));
//# sourceMappingURL=mr_mappy.min.js.map
